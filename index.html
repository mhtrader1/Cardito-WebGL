<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cardito Web</title>

    <style>
      html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #000;
        height: 100%;
      }

      #unity-container {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #unity-canvas {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(var(--scale, 1));
        transform-origin: center center;
        width: 1080px;
        height: 1920px;
        background: #000;
        touch-action: manipulation;
        -webkit-user-select: none;
        user-select: none;
      }
    </style>

    <!-- ======================================================
         ğŸ”Œ Web3 prerequisites
         ====================================================== -->

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="ethers.js"></script>
    <script src="https://unpkg.com/@walletconnect/ethereum-provider/dist/index.umd.js"></script>

    <script>
      window.CARDITO_WC_PROJECT_ID = "7a03ac67d724cd7a88e72da1ec30c7f6";
    </script>

    <script src="SocketBridge.js"></script>

    <!-- ===== HTML Keyboard Overlay for mobile WebGL ===== -->
    <input id="cardito-html-input"
           type="text"
           style="
             position:fixed;
             left:50%;
             bottom:20px;
             transform:translateX(-50%);
             width:80%;
             max-width:400px;
             height:40px;
             padding:8px 10px;
             font-size:16px;
             border-radius:8px;
             border:1px solid #ccc;
             z-index:999999;
             display:none;
             background:#fff;
             color:#000;
           "
           autocomplete="off"
           autocorrect="off"
           autocapitalize="off"
           spellcheck="false" />

    <script>
      (function () {
        const el = document.getElementById("cardito-html-input");

        const overlay = {
          go: null,
          method: null,

          open(goName, methodName, placeholder, currentValue) {
            this.go = goName;
            this.method = methodName;
            el.placeholder = placeholder || "";
            el.value = currentValue || "";
            el.style.display = "block";

            // Ú©Ù…ÛŒ ØªØ£Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù…Ø·Ù…Ø¦Ù†Ø§Ù‹ Ú©ÛŒØ¨ÙˆØ±Ø¯ Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†Ø¯
            setTimeout(() => {
              el.focus();
              el.selectionStart = el.selectionEnd = el.value.length;
            }, 50);
          },

          close(sendBack) {
            el.style.display = "none";
            if (sendBack && this.go && this.method) {
              const val = el.value || "";
              try {
                if (typeof sendMessage === "function") {
                  sendMessage(this.go, this.method, val);
                } else if (typeof unityInstance !== "undefined" && unityInstance) {
                  unityInstance.SendMessage(this.go, this.method, val);
                } else if (typeof SendMessage === "function") {
                  SendMessage(this.go, this.method, val);
                }
              } catch (e) {
                console.error("[HTMLKeyboardOverlay] SendMessage error", e);
              }
            }
            this.go = null;
            this.method = null;
          }
        };

        el.addEventListener("blur", () => overlay.close(true));

        el.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            overlay.close(true);
          } else if (e.key === "Escape") {
            e.preventDefault();
            overlay.close(false);
          }
        });

        // Ø§ÛŒÙ† Ø¢Ø¨Ø¬Ú©Øª Ù‡Ù…Ø§Ù† Ú†ÛŒØ²ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø§Ø² C# Ø¨Ø§ Application.ExternalCall ØµØ¯Ø§ Ø²Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
        window.HTMLKeyboardOverlay = overlay;
      })();
    </script>
    
    <!-- ================================
         â­ Cardito Cinematic Loader
         ================================= -->
<style>
  #cardito-loader {
    position: fixed;
    inset: 0;
    background: white;
    z-index: 999999;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  .letter {
    position: absolute;
    width: 120px;
    opacity: 0;
    top: -20%;
    transition:
      top 0.6s cubic-bezier(0.25, 1, 0.5, 1),
      left 0.6s cubic-bezier(0.25, 1, 0.5, 1),
      opacity 0.5s ease;
  }

  @media (max-width:600px){
    .letter { width:80px; }
  }
</style>

<div id="cardito-loader">
  <img class="letter" id="L1" src="1.png">
  <img class="letter" id="L2" src="2.png">
  <img class="letter" id="L3" src="3.png">
  <img class="letter" id="L4" src="4.png">
  <img class="letter" id="L5" src="5.png">
  <img class="letter" id="L6" src="6.png">
  <img class="letter" id="L7" src="7.png">
</div>

<script>
/* Flags Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ø§Ù‡Ù†Ú¯â€ŒØ³Ø§Ø²ÛŒ */
window.CARDITO_ANIM_DONE = false;
window.UNITY_READY = false;

/* â­ Ø¬Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù‡Ø± Ø­Ø±Ù Ø±ÙˆÛŒ Ø®Ø· Ø§ÙÙ‚ÛŒ */
const pos = { L1:22, L2:32, L3:42, L4:52, L5:62, L6:72, L7:82 };

/* â­ Ù…Ø±Ø­Ù„Ù‡Ù” Ø³Ù‚ÙˆØ· */
Object.keys(pos).forEach((id,i)=>{
  const el = document.getElementById(id);
  el.style.left = pos[id] + "%";
  setTimeout(()=>{
    el.style.top = "46%";
    el.style.opacity = "1";
  }, 200 + i*140);
});

/* â­ helper: Ø­Ø°Ù Ø¨Ù‡ Ø³Ù…Øª Ø¯Ø§Ø®Ù„ */
function vanishInward(id){
  const el = document.getElementById(id);
  const x = parseFloat(el.style.left);
  const inwardShift = (x < 52 ? +6 : -6);

  el.style.left = (x + inwardShift) + "%";
  el.style.opacity = "0";

  setTimeout(() => {
    el.style.display = "none";
  }, 450);
}

/* â­ helper: Ø­Ø±Ú©Øª Ù†Ø±Ù… */
function moveInward(id, amount){
  const el = document.getElementById(id);
  el.style.left = (pos[id] + amount) + "%";
}

/* â­ 1) Ø­Ø°Ù Ø­Ø±Ù ÙˆØ³Ø· (Û´) â€” ÙÙ‚Ø· ÙÛŒØ¯ Ø³Ø§Ø¯Ù‡ */
setTimeout(()=>{
  const el = document.getElementById("L4");
  el.style.transition = "opacity 0.5s ease";
  el.style.opacity = "0";
  setTimeout(()=> el.style.display="none", 500);
}, 2600);

/* â­ 2) Ù†Ø²Ø¯ÛŒÚ© Ø´Ø¯Ù† Ù…ÙˆØ¬ÛŒ */
setTimeout(()=>{
  moveInward("L1",  4);
  moveInward("L2",  4);
  moveInward("L3",  4);
  moveInward("L5", -4);
  moveInward("L6", -4);
  moveInward("L7", -4);
}, 3000);

/* â­ 3) Ø­Ø°Ù Û³ Ùˆ Ûµ */
setTimeout(()=>{
  vanishInward("L3");
  vanishInward("L5");
}, 3600);

/* â­ 4) Ù…ÙˆØ¬ Ø¯ÙˆÙ… Ø­Ø±Ú©Øª */
setTimeout(()=>{
  moveInward("L1", 12);
  moveInward("L2", 12);
  moveInward("L6", -12);
  moveInward("L7", -12);
}, 4200);

/* â­ 5) Ø­Ø°Ù Û² Ùˆ Û¶ */
setTimeout(()=>{
  vanishInward("L2");
  vanishInward("L6");
}, 4700);

/* â­ 6) ÙÙ‚Ø· Û± Ùˆ Û· Ø¨Ù…Ø§Ù†Ù†Ø¯ Ùˆ Ú©Ù†Ø§Ø± Ù‡Ù… Ù‚Ø±Ø§Ø± Ø¨Ú¯ÛŒØ±Ù†Ø¯ */
setTimeout(()=>{
  moveInward("L1", 29);
  moveInward("L7", -29);
}, 5200);

/* â­ 7) Ø®Ø±ÙˆØ¬ Ù„ÙˆØ¯Ø± */
setTimeout(()=>{
  window.CARDITO_ANIM_DONE = true;
  tryStartUnityReveal();
}, 8000);

/* â­ Ù‡Ù…Ø§Ù‡Ù†Ú¯â€ŒÚ©Ù†Ù†Ø¯Ù‡ */
function tryStartUnityReveal(){
  if (window.UNITY_READY && window.CARDITO_ANIM_DONE){
    const loader = document.getElementById("cardito-loader");
    loader.style.opacity = "0";
    setTimeout(()=> loader.style.display="none", 700);
  }
}
</script>

    <!-- ================================
         â­ Original Unity Loader
         ================================= -->
    <div id="unity-container" class="unity-desktop">
      <canvas id="unity-canvas" width="1080" height="1920" tabindex="0"></canvas>

      <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
          <div id="unity-progress-bar-full"></div>
        </div>
      </div>

      <div id="unity-warning"></div>
      <div id="unity-footer">
        <div id="unity-webgl-logo"></div>
        <div id="unity-fullscreen-button"></div>
        <div id="unity-build-title">Cardito Web</div>
      </div>
    </div>

    <script>
      var container = document.querySelector("#unity-container");
      var canvas = document.querySelector("#unity-canvas");
      canvas.tabIndex = 0;
      canvas.style.outline = "none";
      var loadingBar = document.querySelector("#unity-loading-bar");
      var progressBarFull = document.querySelector("#unity-progress-bar-full");
      var fullscreenButton = document.querySelector("#unity-fullscreen-button");
      var warningBanner = document.querySelector("#unity-warning");

      function unityShowBanner(msg, type) {
        function updateBannerVisibility() {
          warningBanner.style.display = warningBanner.children.length ? "block" : "none";
        }
        var div = document.createElement("div");
        div.innerHTML = msg;
        warningBanner.appendChild(div);

        if (type == "error") div.style = "background: red; padding: 10px;";
        else {
          if (type == "warning") div.style = "background: yellow; padding: 10px;";
          setTimeout(() => {
            warningBanner.removeChild(div);
            updateBannerVisibility();
          }, 5000);
        }
        updateBannerVisibility();
      }

      var buildUrl = "Build";
      var loaderUrl = buildUrl + "/WebGL.loader.js";

      var config = {
        dataUrl: buildUrl + "/WebGL.data",
        frameworkUrl: buildUrl + "/WebGL.framework.js",
        codeUrl: buildUrl + "/WebGL.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "Cardito",
        productName: "Cardito Web",
        productVersion: "1.0",
        showBanner: unityShowBanner,
      };

      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        var meta = document.createElement("meta");
        meta.name = "viewport";
        meta.content =
          "width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes";
        document.head.appendChild(meta);
        container.className = "unity-mobile";
        canvas.className = "unity-mobile";
      } else {
        canvas.style.width = "1080px";
        canvas.style.height = "1920px";
      }

      loadingBar.style.display = "block";

      function waitForIntro() {
        return new Promise(resolve => {
          if (window.CARDITO_ANIM_DONE) return resolve();
          const interval = setInterval(() => {
            if (window.CARDITO_ANIM_DONE) {
              clearInterval(interval);
              resolve();
            }
          }, 100);
        });
      }

      var script = document.createElement("script");
      script.src = loaderUrl;

      script.onload = () => {
        window.UNITY_READY = true;
        tryStartUnityReveal();

        waitForIntro().then(() => {
          createUnityInstance(canvas, config, (progress) => {
            progressBarFull.style.width = (progress * 100) + "%";
          }).then((unityInstance) => {

            window.sendMessage = function(obj, method, param) {
              try { unityInstance.SendMessage(obj, method, param); }
              catch (e) { console.error("[sendMessage ERROR]", e); }
            };

            loadingBar.style.display = "none";
            fullscreenButton.onclick = () => unityInstance.SetFullscreen(1);

            window.unityInstance = unityInstance;

          }).catch((msg) => console.error(msg));
        });
      };

      document.body.appendChild(script);
    </script>

    <!-- ======================
         Canvas Fitting Logic
         ====================== -->
    <script>
      function fitCanvas() {
        const canvas = document.getElementById("unity-canvas");
        const scaleX = window.innerWidth / 1080;
        const scaleY = window.innerHeight / 1920;
        const scale = Math.min(scaleX, scaleY);
        canvas.style.setProperty("--scale", scale);
      }

      window.addEventListener("resize", fitCanvas);
      fitCanvas();
    </script>

  </body>
</html>
